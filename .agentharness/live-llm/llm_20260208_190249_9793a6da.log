AgentHarness LLM Live Output
Start: 2026-02-08T19:02:49
CWD: C:/Users/shlob/Pycharm Projects/harness-test/harness-test-4
Command: gemini --model gemini-3-pro-preview --yolo

Provider: Gemini, Model: gemini-3-pro-preview | Timeout: 300s
Prompt transport: stdin (28668 chars)
LLM prompt begin (stdin)
Create a git commit message and write it to `.agentharness/git-commit-message.txt`.

Rules:
1. Only edit `.agentharness/git-commit-message.txt`.
2. Write a concise commit message following standards.
3. Use the provided git status and diff snapshot; do not run git commands.
4. Do not create or modify any other file.

Commit message quality:
- Start with a verb (Add, Fix, Update, Implement, Refactor, etc.)
- Be concise but specific
- Reflect the main change just completed in the provided git diff snapshot and in the recent changes file

GIT STATUS (PORCELAIN):
M .agentharness/git-commit-message.txt
 M .codex_last_message.txt
 M developer-guide.md
 M recent-changes.md
 M src/ai/developer-guide.md
 M src/ai/tactics.py
 M src/core/__init__.py
 M src/core/developer-guide.md
 M src/developer-guide.md
 M src/environment/collision.py
 M src/environment/developer-guide.md
 M src/environment/facility.py
 M tasks.md
 M tests/developer-guide.md
 M tests/test_core_systems.py
 M tests/test_environment_and_tactics.py
?? .agentharness/live-llm/llm_20260208_185640_73f8dacd.log
?? .agentharness/live-llm/llm_20260208_190052_3041b802.log
?? .agentharness/live-llm/llm_20260208_190204_e1dd08bb.log
?? src/core/runtime.py

GIT DIFF:
diff --git a/.agentharness/git-commit-message.txt b/.agentharness/git-commit-message.txt
index 4bcdbf3..e69de29 100644
--- a/.agentharness/git-commit-message.txt
+++ b/.agentharness/git-commit-message.txt
@@ -1,6 +0,0 @@
-Implement HUD system and rebalance economy
-
-- Add `src/hud` with `HudOverlayController` for health, ammo, money, and feedback.
-- Add `tests/test_hud.py` to validate HUD behavior.
-- Rebalance weapon prices in `config/config.py` (Shotgun 250, AR 800, RPG 2000).
-- Update tests and documentation to reflect HUD addition and price changes.
\ No newline at end of file
diff --git a/.codex_last_message.txt b/.codex_last_message.txt
index 37fe1be..35a7ecc 100644
--- a/.codex_last_message.txt
+++ b/.codex_last_message.txt
@@ -1,3 +1,3 @@
-Reviewed `git diff` for UI/UX-only issues and found none.
+Inspected the recent changes with `git diff` and reviewed UI/HUD-related code paths.
 
-`review/ui_ux.md` is empty.
\ No newline at end of file
+No UI/UX issues were found in the diff, so `review/ui_ux.md` remains empty.
\ No newline at end of file
diff --git a/developer-guide.md b/developer-guide.md
index 769e46d..870f6a9 100644
--- a/developer-guide.md
+++ b/developer-guide.md
@@ -7,6 +7,7 @@ The current codebase implements engine-agnostic gameplay foundations in pure Pyt
 - Core runtime loop and timing
 - State machine for high-level game flow
 - Clock pause/resume and time scaling controls
+- Runtime bridge for HUD damage/kill event hooks through the frame loop
 - Input normalization for WASD + mouse look
 - First-person camera and movement/collision simulation
 - Raycasting-based hit-scan traces
@@ -16,13 +17,15 @@ The current codebase implements engine-agnostic gameplay foundations in pure Pyt
 - Shop wheel UI logic with radial layout, weapon prices, affordability feedback, purchase validation, and inventory equip flow
 - HUD overlay logic for health/ammo/money/crosshair, damage feedback, and kill notifications
 - Multi-room facility model with doorway connectivity, cover placements, lighting profile, and nav waypoints
+- Facility layout validation for doorways, spawn placement, and non-degenerate lighting vectors
 - Collision world generation from environment rooms/doorways/cover for movement and projectile systems
 - Bot runtime model with stateful health/death handling, shot variance, tactical action selection, cover/flank planning, and wave spawning
 - Money drop economy with collectible pickups, collision-based collection, and primitive visual definitions
 
 ## Directory Map
 - `src/`: runtime game systems.
-  - `src/core/`: game loop, game clock, state manager, input, camera, movement, collision primitives, and raycasting.
+- `src/core/`: game loop, game clock, state manager, input, camera, movement, collision primitives, and raycasting.
+- `src/core/`: game loop, game clock, state manager, input, camera, movement, collision primitives, raycasting, and HUD event/runtime bridges.
   - `src/player/`: player runtime state, combat APIs, instant/smooth inventory switching, reload, hit-scan, and respawn.
   - `src/weapons/`: weapon base model, concrete implementations, visual definitions, and switch transition state.
   - `src/projectiles/`: projectile entity construction and world collision physics.
@@ -65,11 +68,12 @@ The current codebase implements engine-agnostic gameplay foundations in pure Pyt
 - `ai.tactics` evaluates cover and picks `attack`/`take_cover`/`flank`, including side-approach flank routes.
 - `ai.waves.WaveDirector` scales bot count and difficulty as waves progress.
 - `WaypointPathfinder` computes nearest-waypoint BFS paths for baseline bot movement planning.
-- `environment.create_default_facility_layout()` defines a 5-room indoor map with doorways, cover, waypoints, bot/player spawns, and lighting values.
+- `environment.create_default_facility_layout()` defines and validates a 5-room indoor map with doorways, cover, waypoints, bot/player spawns, and lighting values.
 - `environment.build_collision_world(...)` transforms environment geometry into wall+cover collision AABBs.
 - `environment.build_waypoint_pathfinder(...)` builds validated nav graphs from facility waypoint data.
 - `MoneyPickupSystem` manages spawned money drops, pickup collisions, TTL expiration, and player-balance updates.
 - `HudOverlayController` builds a single HUD payload and tracks timed damage/kill feedback effects.
+- `HudEventRuntimeBridge` + `RuntimeSession` hook HUD damage/kill events into `GameLoop` update callbacks and expose frame-ready HUD state.
 
 ## Development Notes
 - Keep gameplay constants in `config/config.py` until a richer configuration layer is needed.
diff --git a/recent-changes.md b/recent-changes.md
index 5769355..4f68fdf 100644
--- a/recent-changes.md
+++ b/recent-changes.md
@@ -1,7 +1,30 @@
 # Recent Changes
 
-- Added a new `src/hud/` module with `HudOverlayController` and render-ready HUD state models for health bar, ammo counter, money display, center crosshair, damage indicator, and kill notifications/counter.
-- Added `tests/test_hud.py` to validate core HUD behavior, damage flash timing, and kill feed lifecycle.
-- Rebalanced economy progression prices in `config/config.py` to Shotgun `250`, AssaultRifle `800`, RPG `2000`, and updated affected tests/docs.
-- Updated developer guides in `developer-guide.md`, `src/developer-guide.md`, `src/ui/developer-guide.md`, `config/developer-guide.md`, and `tests/developer-guide.md` to reflect the new HUD system and economy curve.
+- Implemented HUD runtime event integration via `src/core/runtime.py`:
+  - Added `HudEventRuntimeBridge` to queue damage/kill events and flush them during `GameLoop` playing-frame callbacks.
+  - Added `RuntimeSession` to compose `Player`, `GameLoop`, and HUD hooks (`apply_player_damage`, `register_bot_kill`, `build_hud_state`).
+  - Exported new runtime types from `src/core/__init__.py`.
+- Expanded environment completeness in `src/environment/facility.py`:
+  - Added explicit doorway connectivity graph traversal (`doorway_graph`, `connected_room_ids`).
+  - Added room lookup helper for positions (`find_room_for_position`).
+  - Added lighting vector helper (`lighting_direction_length`).
+  - Added layout validation for doorway references/widths, spawn presence/placement, lighting sanity, and room validity.
+  - `create_default_facility_layout()` now validates before returning.
+- Added targeted complex-algorithm comments:
+  - Doorway wall-segment splitting in `src/environment/collision.py`.
+  - Segment-projection geometry in `src/ai/tactics.py`.
+- Strengthened tests:
+  - `tests/test_core_systems.py` now verifies runtime HUD damage/kill hooks only apply on `playing` frames.
+  - `tests/test_environment_and_tactics.py` now verifies full room connectivity, spawn positions inside rooms, and lighting validity.
+- Verified documentation/codebase constraints:
+  - No `developer-guide.md` file exceeds 500 lines.
+  - No Python code file exceeds 1000 lines.
+  - No folder contains more than 10 Python code files.
+- Updated relevant developer guides after folder changes:
+  - `src/core/developer-guide.md`
+  - `src/environment/developer-guide.md`
+  - `src/ai/developer-guide.md`
+  - `src/developer-guide.md`
+  - `tests/developer-guide.md`
+  - `developer-guide.md`
 
diff --git a/src/ai/developer-guide.md b/src/ai/developer-guide.md
index 2c446b8..45b001f 100644
--- a/src/ai/developer-guide.md
+++ b/src/ai/developer-guide.md
@@ -18,6 +18,7 @@
 - `Bot.spawn_money_drop(...)` emits a `MoneyPickup` through `MoneyPickupSystem` and is allowed only after death.
 - `WaypointPathfinder.find_path(...)` maps world positions to nearest waypoints and returns a connected path using BFS over waypoint links.
 - `find_cover_plan(...)` finds nearest usable cover that can break line-of-fire from player to bot.
+- `tactics` geometry helpers use 2D segment projection to estimate whether cover blocks the player->bot line.
 - `choose_tactical_action(...)` decides between `attack`, `take_cover`, and `flank` based on health, distance, allies, and available cover. Raises `ValueError` if called on a dead bot; callers must filter dead bots before calling.
 - `build_flank_route(...)` returns side-approach points so bots can pressure from multiple angles.
 - `WaveDirector` scales bot count and difficulty per wave and spawns wave bots at provided spawn positions.
diff --git a/src/ai/tactics.py b/src/ai/tactics.py
index 93dd1af..3a39e4f 100644
--- a/src/ai/tactics.py
+++ b/src/ai/tactics.py
@@ -44,6 +44,7 @@ def _segment_point_distance_2d(a: Vector3, b: Vector3, p: Vector3) -> float:
     ab_len_sq = (ab_x * ab_x) + (ab_z * ab_z)
     if ab_len_sq <= 1e-9:
         return _distance_2d(a, p)
+    # Project point p onto segment ab and clamp to segment endpoints.
     t = ((ap_x * ab_x) + (ap_z * ab_z)) / ab_len_sq
     t = max(0.0, min(1.0, t))
     closest = (a[0] + (ab_x * t), 0.0, a[2] + (ab_z * t))
diff --git a/src/core/__init__.py b/src/core/__init__.py
index 61af34f..bebbc32 100644
--- a/src/core/__init__.py
+++ b/src/core/__init__.py
@@ -8,6 +8,7 @@ from src.core.game_state import GameState, GameStateManager
 from src.core.input_handler import InputFrame, InputHandler, InputSnapshot
 from src.core.movement import PlayerMovementController
 from src.core.raycasting import RaycastHit, RaycastingSystem, RaycastTarget
+from src.core.runtime import HudEventRuntimeBridge, RuntimeSession
 
 __all__ = [
     "AABB",
@@ -24,4 +25,6 @@ __all__ = [
     "RaycastHit",
     "RaycastingSystem",
     "RaycastTarget",
+    "HudEventRuntimeBridge",
+    "RuntimeSession",
 ]
diff --git a/src/core/developer-guide.md b/src/core/developer-guide.md
index 17eddaf..49b8617 100644
--- a/src/core/developer-guide.md
+++ b/src/core/developer-guide.md
@@ -12,6 +12,7 @@
 - `collision.py`: AABB and `CollisionWorld` primitives for wall/bounds collision checks.
 - `movement.py`: `PlayerMovementController` for yaw-relative movement with collision + slide resolution.
 - `raycasting.py`: `RaycastingSystem` with nearest-hit line traces against spherical targets for hit-scan shooting.
+- `runtime.py`: runtime composition helpers that wire `HudOverlayController` damage/kill events into `GameLoop` frame updates.
 
 ## Behavior Notes
 - `GameStateManager` blocks invalid transitions with `ValueError`.
@@ -24,3 +25,5 @@
 - Movement checks full displacement first, then attempts axis-aligned slide fallback before stopping.
 - `CollisionWorld.outside_world_bounds` checks full containment: returns `True` if any part of the box is outside world bounds.
 - `RaycastingSystem.cast_ray(...)` returns the closest valid target hit (or `None`) within max distance.
+- `HudEventRuntimeBridge` queues damage/kill events and flushes them only on active `playing` frames.
+- `RuntimeSession` provides a minimal player+HUD runtime wrapper with `apply_player_damage(...)`, `register_bot_kill(...)`, and `build_hud_state(...)`.
diff --git a/src/developer-guide.md b/src/developer-guide.md
index c8eaf64..16344ae 100644
--- a/src/developer-guide.md
+++ b/src/developer-guide.md
@@ -4,7 +4,7 @@
 `src/` contains the game runtime modules for loop/state management, player logic, weapons, and projectile simulation.
 
 ## Folder Overview
-- `core/`: frame stepping, game clock (pause + time scale), state machine, input normalization, first-person camera state, movement, collision primitives, and raycasting.
+- `core/`: frame stepping, game clock (pause + time scale), state machine, input normalization, first-person camera state, movement, collision primitives, raycasting, and HUD runtime event bridges.
 - `player/`: player runtime model (health, money, inventory, immediate + smooth weapon switching, reload, hit-scan/projectile shooting, game-over/respawn).
 - `weapons/`: reusable weapon abstractions, concrete weapons (pistol/shotgun/assault rifle/RPG), switch-transition state, and primitive visual definitions.
 - `projectiles/`: projectile entities plus physics stepping and world collision checks.
@@ -12,7 +12,7 @@
 - `hud/`: HUD overlay payload generation for health, ammo, money, crosshair, damage feedback, and kill notifications.
 - `ai/`: bot runtime model, shot-accuracy helpers, tactical decision/cover/flank planners, and wave spawning+difficulty scaling.
 - `economy/`: money pickup entities, glowing primitive visual definitions, pickup lifecycle, and player collection logic.
-- `environment/`: multi-room facility definitions, doorway connectivity, cover placements, collision world generation, and nav graph generation.
+- `environment/`: multi-room facility definitions, doorway connectivity, spawn/light validation helpers, cover placements, collision world generation, and nav graph generation.
 
 ## Integration Flow
 1. The platform layer collects raw input and passes it to `core.input_handler.InputHandler`.
@@ -31,3 +31,4 @@
 14. `ai.waves.WaveDirector` scales wave difficulty and spawns multiple bots from configured spawn positions.
 15. `economy.money.MoneyPickupSystem` resolves pickup collisions and deposits collected money to `player.Player`.
 16. `hud.HudOverlayController` builds render-ready HUD state and manages damage/kill feedback timers.
+17. `core.runtime.RuntimeSession` and `HudEventRuntimeBridge` queue gameplay damage/kill events and flush them to HUD only during active `playing` loop frames.
diff --git a/src/environment/collision.py b/src/environment/collision.py
index fbbaf8e..d66c868 100644
--- a/src/environment/collision.py
+++ b/src/environment/collision.py
@@ -16,6 +16,7 @@ def _interval_subtract(start: float, end: float, cuts: list[tuple[float, float]]
         if cut_max <= cut_min:
             continue
         next_segments: list[tuple[float, float]] = []
+        # Split each surviving segment around the doorway opening.
         for seg_min, seg_max in segments:
             if cut_max <= seg_min or cut_min >= seg_max:
                 next_segments.append((seg_min, seg_max))
diff --git a/src/environment/developer-guide.md b/src/environment/developer-guide.md
index 57e549b..a875244 100644
--- a/src/environment/developer-guide.md
+++ b/src/environment/developer-guide.md
@@ -4,7 +4,7 @@
 `src/environment/` defines the indoor facility layout and turns that layout into reusable collision and navigation data.
 
 ## Files
-- `facility.py`: dataclasses for rooms, doorways, cover objects, spawn points, and lighting; includes `create_default_facility_layout()` with a 5-room tactical facility.
+- `facility.py`: dataclasses for rooms, doorways, cover objects, spawn points, and lighting; includes `create_default_facility_layout()` with a validated 5-room tactical facility and helpers for doorway graph traversal and spawn-room lookups.
 - `collision.py`: converts room boundaries + doorway openings + blocking cover into a `CollisionWorld` for player and projectile collision.
 - `navigation.py`: validates layout waypoint links and creates a `WaypointPathfinder`.
 - `__init__.py`: package exports for facility, collision, and navigation helpers.
@@ -16,8 +16,10 @@
 - Waypoint graph and links for AI route planning.
 - Spawn point records for player and bots.
 - Engine-agnostic ambient + directional lighting profile.
+- Layout validation enforces doorway integrity, spawn placement inside rooms, non-zero directional light vectors, and minimum room count.
 
 ## Integration Notes
 - Build runtime collision data with `build_collision_world(layout)` and pass it to movement/projectile systems.
 - Build AI pathfinding with `build_waypoint_pathfinder(layout)` to keep navigation synced with room geometry.
 - Keep room and doorway geometry in `facility.py` as the single source of truth for environment updates.
+- Use `layout.connected_room_ids(...)` and `layout.find_room_for_position(...)` when systems need explicit room connectivity or spawn/position checks.
diff --git a/src/environment/facility.py b/src/environment/facility.py
index 4f228f2..9e85515 100644
--- a/src/environment/facility.py
+++ b/src/environment/facility.py
@@ -3,6 +3,7 @@
 from __future__ import annotations
 
 from dataclasses import dataclass
+from math import sqrt
 from typing import Literal
 
 
@@ -105,6 +106,37 @@ class FacilityLayout:
     def room_ids(self) -> set[str]:
         return set(self.rooms.keys())
 
+    def doorway_graph(self) -> dict[str, set[str]]:
+        graph: dict[str, set[str]] = {room_id: set() for room_id in self.rooms}
+        for doorway in self.doorways:
+            graph.setdefault(doorway.room_a, set()).add(doorway.room_b)
+            graph.setdefault(doorway.room_b, set()).add(doorway.room_a)
+        return graph
+
+    def connected_room_ids(self, start_room_id: str) -> set[str]:
+        """Return every room reachable from a starting room through doorways."""
+        if start_room_id not in self.rooms:
+            raise ValueError(f"Unknown room_id '{start_room_id}'.")
+        graph = self.doorway_graph()
+        visited: set[str] = set()
+        frontier = [start_room_id]
+        while frontier:
+            room_id = frontier.pop()
+            if room_id in visited:
+                continue
+            visited.add(room_id)
+            for neighbor in graph.get(room_id, set()):
+                if neighbor not in visited:
+                    frontier.append(neighbor)
+        return visited
+
+    def find_room_for_position(self, position: Vector3) -> str | None:
+        x, _, z = position
+        for room in self.rooms.values():
+            if room.min_x <= x <= room.max_x and room.min_z <= z <= room.max_z:
+                return room.room_id
+        return None
+
     def bot_spawn_positions(self) -> list[Vector3]:
         return [spawn.position for spawn in self.spawn_points if spawn.team == "bot"]
 
@@ -114,6 +146,45 @@ class FacilityLayout:
                 return spawn.position
         raise ValueError("Facility layout must define one player spawn point.")
 
+    def lighting_direction_length(self) -> float:
+        direction = self.lighting.directional_direction
+        return sqrt(
+            (direction[0] * direction[0])
+            + (direction[1] * direction[1])
+            + (direction[2] * direction[2])
+        )
+
+    def validate(self) -> None:
+        """Validate doorway/spawn/lighting integrity for runtime safety."""
+        room_ids = self.room_ids()
+        for doorway in self.doorways:
+            if doorway.room_a not in room_ids or doorway.room_b not in room_ids:
+                raise ValueError(f"Doorway '{doorway.doorway_id}' links undefined rooms.")
+            if doorway.width <= 0.0:
+                raise ValueError(f"Doorway '{doorway.doorway_id}' width must be positive.")
+
+        player_spawns = [spawn for spawn in self.spawn_points if spawn.team == "player"]
+        if len(player_spawns) != 1:
+            raise ValueError("Facility layout must define exactly one player spawn.")
+        bot_spawns = [spawn for spawn in self.spawn_points if spawn.team == "bot"]
+        if not bot_spawns:
+            raise ValueError("Facility layout must define at least one bot spawn.")
+        for spawn in self.spawn_points:
+            if self.find_room_for_position(spawn.position) is None:
+                raise ValueError(f"Spawn point '{spawn.spawn_id}' is outside all rooms.")
+
+        if self.lighting.ambient_intensity < 0.0 or self.lighting.directional_intensity < 0.0:
+            raise ValueError("Lighting intensities must be non-negative.")
+        if self.lighting_direction_length() <= 0.0:
+            raise ValueError("Directional lighting direction must be non-zero.")
+
+        # Distinct-room requirement for tactical variety.
+        if len(self.rooms) < 3:
+            raise ValueError("Facility layout must define at least three rooms.")
+        for room in self.rooms.values():
+            if room.max_x <= room.min_x or room.max_z <= room.min_z:
+                raise ValueError(f"Room '{room.room_id}' has invalid dimensions.")
+
 
 def create_default_facility_layout() -> FacilityLayout:
     """Return a 5-room tactical facility with doorways, cover, and nav data."""
@@ -237,7 +308,7 @@ def create_default_facility_layout() -> FacilityLayout:
         directional_direction=(-0.6, -1.0, -0.3),
     )
 
-    return FacilityLayout(
+    layout = FacilityLayout(
         rooms=rooms,
         doorways=doorways,
         cover_objects=cover_objects,
@@ -246,3 +317,5 @@ def create_default_facility_layout() -> FacilityLayout:
         spawn_points=spawn_points,
         lighting=lighting,
     )
+    layout.validate()
+    return layout
diff --git a/tasks.md b/tasks.md
index b330cd9..442f3df 100644
--- a/tasks.md
+++ b/tasks.md
@@ -83,10 +83,10 @@
 - [x] Implement wall collision detection for player and projectiles
 - [x] Add cover objects (crates, walls) throughout the facility
 - [x] Create navigation data for AI pathfinding
-- [ ] Implement room connectivity and doorways
-- [ ] Add environmental lighting setup
-- [ ] Create spawn points for player and bots
-- [ ] Design at least 3-5 distinct rooms with tactical variety
+- [x] Implement room connectivity and doorways
+- [x] Add environmental lighting setup
+- [x] Create spawn points for player and bots
+- [x] Design at least 3-5 distinct rooms with tactical variety
 - [x] Create src/environment folder developer-guide.md
 
 ## HUD System
@@ -99,7 +99,7 @@
 - [x] Create damage indicator visual feedback
 - [x] Add kill notification or counter display
 - [x] Create src/hud folder developer-guide.md
-- [ ] Integrate HudOverlayController event hooks into the runtime update loop (damage + kill events)
+- [x] Integrate HudOverlayController event hooks into the runtime update loop (damage + kill events)
 
 ## Special Effect: "The Glitch"
 
@@ -165,10 +165,10 @@
 - [x] Ensure all code folders have up-to-date developer-guide.md files
 - [x] Create README.md with installation and running instructions
 - [x] Document controls and gameplay in user-facing documentation
-- [ ] Add code comments for complex algorithms
-- [ ] Review and compact any developer-guide.md files over 500 lines
-- [ ] Verify no code files exceed 1000 lines
-- [ ] Verify no folders have more than 10 code files
+- [x] Add code comments for complex algorithms
+- [x] Review and compact any developer-guide.md files over 500 lines
+- [x] Verify no code files exceed 1000 lines
+- [x] Verify no folders have more than 10 code files
 
 ## Deployment & Build
 
diff --git a/tests/developer-guide.md b/tests/developer-guide.md
index 2b952ac..6242575 100644
--- a/tests/developer-guide.md
+++ b/tests/developer-guide.md
@@ -14,12 +14,12 @@ This directory contains the automated test suite for the FPS Bot Arena project.
 
 ## Current Test Modules
 - `test_config.py`: validates immutable config defaults.
-- `test_core_systems.py`: validates game clock timing controls, raycasting behavior, state transitions, input handling, and loop update dispatch behavior.
+- `test_core_systems.py`: validates game clock timing controls, raycasting behavior, state transitions, input handling, loop update dispatch behavior, and runtime HUD event hook integration.
 - `test_player_and_weapons.py`: validates player health/economy/inventory/shooting and weapon cooldown/ammo behavior.
 - `test_advanced_combat_and_movement.py`: validates camera look, movement collision/slide, smooth weapon switching transitions, hit-scan shooting, weapon visuals, weapon behaviors, and projectile collisions.
 - `test_shop_ui.py`: validates shop wheel radial layout, `B`-toggle input behavior, pause/state synchronization while shopping, pricing visibility, affordability feedback, purchase validation, and owned-weapon selection/equip behavior.
 - `test_ai_and_economy.py`: validates bot health/state transitions, waypoint pathfinding, accuracy-varied bot shooting, death money-drop spawning, pickup collision, visual mapping, and player collection flow.
-- `test_environment_and_tactics.py`: validates multi-room facility structure, doorway-aware collision generation, environment nav graph usage, tactical cover/flank decisions, and wave difficulty scaling/spawning.
+- `test_environment_and_tactics.py`: validates multi-room facility structure, doorway connectivity traversal, spawn placement inside rooms, lighting validity, doorway-aware collision generation, environment nav graph usage, tactical cover/flank decisions, and wave difficulty scaling/spawning.
 - `test_hud.py`: validates HUD snapshot generation (health/ammo/money/crosshair), damage indicator timing, and kill notification/counter behavior.
 
 ## Running Tests
diff --git a/tests/test_core_systems.py b/tests/test_core_systems.py
index 3581570..33c0942 100644
--- a/tests/test_core_systems.py
+++ b/tests/test_core_systems.py
@@ -3,8 +3,10 @@ import pytest
 from src.core.game_clock import GameClock
 from src.core.game_loop import GameLoop
 from src.core.raycasting import RaycastingSystem, RaycastTarget
+from src.core.runtime import RuntimeSession
 from src.core.game_state import GameState, GameStateManager
 from src.core.input_handler import InputHandler, InputSnapshot
+from src.player.player import Player
 
 
 def test_game_clock_tracks_delta_and_elapsed_time():
@@ -111,3 +113,24 @@ def test_game_loop_updates_only_while_playing():
     loop.step(1.4)
     loop.step(1.8)
     assert deltas == pytest.approx([0.3, 0.4])
+
+
+def test_runtime_session_routes_damage_and_kill_events_to_hud_during_playing_frames():
+    manager = GameStateManager()
+    loop = GameLoop(state_manager=manager)
+    player = Player.with_starter_loadout(start_health=100, start_money=0)
+    session = RuntimeSession(player=player, game_loop=loop)
+
+    session.apply_player_damage(25)
+    session.register_bot_kill("Bot Delta")
+    not_playing_state = session.build_hud_state()
+    assert not_playing_state.damage_indicator.is_visible is False
+    assert not_playing_state.kill_count == 0
+
+    manager.transition_to(GameState.PLAYING)
+    loop.step(10.0)
+    playing_state = session.build_hud_state()
+    assert playing_state.health.current_health == 75
+    assert playing_state.damage_indicator.is_visible is True
+    assert playing_state.kill_count == 1
+    assert [note.message for note in playing_state.kill_notifications] == ["Bot Delta eliminated"]
diff --git a/tests/test_environment_and_tactics.py b/tests/test_environment_and_tactics.py
index 358cf2b..3956119 100644
--- a/tests/test_environment_and_tactics.py
+++ b/tests/test_environment_and_tactics.py
@@ -15,6 +15,19 @@ def test_default_facility_has_five_rooms_and_doorway_connectivity():
     for doorway in layout.doorways:
         assert doorway.room_a in room_ids
         assert doorway.room_b in room_ids
+    assert layout.connected_room_ids("lobby") == room_ids
+
+
+def test_layout_has_spawn_points_inside_rooms_and_valid_lighting_profile():
+    layout = create_default_facility_layout()
+    assert layout.player_spawn_position() in [spawn.position for spawn in layout.spawn_points if spawn.team == "player"]
+    assert len(layout.bot_spawn_positions()) >= 1
+    for spawn in layout.spawn_points:
+        assert layout.find_room_for_position(spawn.position) is not None
+
+    assert layout.lighting.ambient_intensity >= 0.0
+    assert layout.lighting.directional_intensity > 0.0
+    assert layout.lighting_direction_length() > 0.0
 
 
 def test_collision_world_from_layout_respects_doorway_openings_and_cover():
LLM prompt end (stdin)
Process PID: 32216
YOLO mode is enabled. All tool calls will be automatically approved.
Loaded cached credentials.
YOLO mode is enabled. All tool calls will be automatically approved.
Hook registry initialized with 0 hook entries
Attempt 1 failed: You have exhausted your capacity on this model. Your quota will reset after 1s.. Retrying after 1405.247884ms...
Attempt 2 failed: You have exhausted your capacity on this model.. Retrying after 10000ms...
Attempt 3 failed: You have exhausted your capacity on this model. Your quota will reset after 1s.. Retrying after 1735.019151ms...
The commit message has been generated and written to `.agentharness/git-commit-message.txt`.
Process exited with code 0. Output length: 659 chars.
End: 2026-02-08T19:03:35
__AGENTHARNESS_LIVE_DONE__
